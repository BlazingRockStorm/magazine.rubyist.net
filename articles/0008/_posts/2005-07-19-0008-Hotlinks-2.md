---
layout: post
title: Rubyist Hotlinks 【第 8 回】 田中哲さん その2
short_title: Rubyist Hotlinks 【第 8 回】 田中哲さん その2
tags: 0008 Hotlinks
---
{% include base.html %}


## インタビュー(2/3)

[ [1]({{base}}{% post_url articles/0008/2005-07-19-0008-Hotlinks-1 %}) | 2 | [3]({{base}}{% post_url articles/0008/2005-07-19-0008-Hotlinks-3 %}) ]

* Table of content
{:toc}


### 生い立ち

__笹田__　じゃぁ、生い立ちから。

__田中__　fj で育ったんですよ。

__笹田__　(笑) その前。その前。

__田中__　その前ですか。東京で生まれて、あるとき北陸に行こうと思い立って北陸に行きました。で、北陸に6年ほど籠って、次はつくばですね。

__笹田__　(笑) もうちょっと細かく。小学校とか中学校とか。何をどうしたらこうなっちゃったのかな、と。

__田中__　こうなっちゃた。

__笹田__　スポーツとかは？

__田中__　スポーツは今も昔もしません。

__笹田__　本とか読んでる少年？

__田中__　読みますね。コンピュータに最初に触れたのはたしか小学校4年生くらいで、VIC-1001 っていう8ビットの Commodore のマシンだったかな。でも、よくわかんなくて結局たいしたことやってない。別にプログラムもしなかったし。

__笹田__　ゲームとかはなかった？

__田中__　カセットテープで売ってるのがあって、いくつか買ってやったような気がしますが、まぁたいしてやらなかったですね。ただ、CG に凄く興味を持ったように思いますね。とはいえ自分でやるわけではなく、ああなんかやりたいなぁ、と思って。

で、もうちょっと後になると、FM77[^1]。しばらく BASIC を触って。グラフィックスに興味を持っていたのでレイトレーシングを書こうと決心して。書いた覚えがあります。

__笹田__　え、それは何時ごろ？

__田中__　中学校か高校のころだと思いますが。

__笹田__　BASIC で？

__田中__　BASIC で。

ただ、レイトレーシングでは反射と屈折を再帰的にたどらないといけないんですが、BASIC は再帰が困難という問題がありました。まぁ GOSUB はあるんで再帰自体は出来るんですが。でも、ふつうの BASIC はローカル変数がないのでそれをどうしたらいいかというのが問題でした。どうしたかっていうと、すべての変数を配列にして、再帰のレベルでアクセスするわけです。

__笹田__　自分でスタックを作る。

__田中__　そう。今風に言えば、っていうほど今風ではない気がしますが、変数毎にスタックがあるような感じで shallow binding[^2] っていうところですかね。いや違うかな？ まあともかく、そういうのを書いた。

で、苦労したのは、for 文が書けないってところですね。インデックスに配列の変数が使えないんですね。使えてもいいと思うんだけど。だから、while 文で全部書き直しました。そのときは while って素晴らしいと思いました。

BASIC で他にまともなプログラムを書いたのかどうかはちょっと覚えてません。

その後、何かの拍子に OS-9[^3] がやってきて。6809 用に書かれた OS です。マイクロウェア[^4] の。それが 8 bit で動くくせにマルチタスクでさ、UNIX っぽい。その上に [Basic09](http://en.wikipedia.org/wiki/BASIC09_programming_language) というのがあって。これは Basic という名前なんだけどずっとまともな言語で。その上でもレイトレーシングとか書いた気がします。ローカル変数とか procedure に感動したような覚えがありますね。

で、このころにはアセンブラでソートプログラムを書いた気がしますね。

__笹田__　高校時代？

__田中__　多分そのころ。そのときにアセンブラ覚えて、俺が覚えた唯一のアセンブラが 6809。他のアセンブラは真面目に勉強したことがない。いまひとつ x86、Pentium のレジスタ構成は、とかきかれてもぴんとこない。

で、そのときにソートコマンド相当のものを書いて、ダブルリンクトリストを使って結構でかいプログラムになった。

__笹田__　なんでそんなの作ったんですか。

__田中__　ソートコマンドが無かったから。

__笹田__　そのころ何してたんですか。

__田中__　レイトレーシング書いてたのはたしかそれで。他にはレポートの計算をしてましたね。

高校は工業高校で、実験の結果とかいろいろと計算しないといけない。そのための計算をしていました。電子科だったんですが、複素数が必要なんですね。で、複素数を計算するのが凄く面倒だったんですね。なんでかというと、Basic09 にはオペレータオーバーローディング[^5]がないから。全部関数で書かないといけない。これは非常に痛い。この憤りは、随分と後になるまで解決されないんですけど。

そうこうしているうちに、次は Sony の NEWS[^6] を使うようになった。

で、ここで UNIX になって、Perl を覚えたんですね。

最初は結構長い間 sh と awk で生活してました。そのころはネットワークコネクションがなくて Perl を取ってくるのが困難だったから。

何をやってたかな。何のためだったか覚えてないんだけど、shell スクリプトを生成する awk スクリプトを生成する awk スクリプトを使う shell スクリプトを書いた覚えがあります。

__笹田__　(笑)

__田中__　なんでかというと、NEWS に載っている awk は old awk というやつで、正規表現がパターンのところにしか書けないんです。で、要求としては configuration file に正規表現を書きたかった。でも、configuration file に書いてある正規表現を動かすには awk に変換しないといけない。だから configuration file から awk スクリプトを生成するわけです。そして、そのスクリプトは、目的がファイルを弄ることだったんだけど、old awk はファイルを弄れないんですね。awk はフィルタだから。そうすると shell スクリプトを生成して sh -s につなぐ、という話になる。というわけで、awk スクリプトで configuration file から awk スクリプトを生成して、その awk スクリプトが生成するのは shell スクリプト、その shell スクリプトはパイプでシェルに渡されて実作業をする。今から考えると非常に信じがたい苦労をしたわけですね。

__笹田__　そんな高校時代だったんですか。

__田中__　それは大学だったかな。

__笹田__　小学校から、どんな興味の変遷があったんですかね。

__田中__　基本的にグラフィックに興味を持ってました。

__笹田__　子供のころだとゲームを作りたい、とかが多いような気がするんですが。

__田中__　もっとプリミティブに 3D グラフィックですかね。ワイヤーフレーム出したいとか。[Pixel](GoogleJ:雑誌Pixel) という雑誌があって、買っていたりしました。Oh! FM とかにレイトレーシングの記事があって、大事に何度も読んでた。

__笹田__　中学校のころとかも？

__田中__　コンピュータに関して、自分はかなり贅沢というか。リソースが十分にないと作業をしない、というのがあって。その結果、速いマシンが使えるまではたいしたことはやってなかった気がします。最初のマシンでは何もやんなかったし、77でもたいしたことはやらなかった気がする。77で覚えてるのは OS-9 上の C コンパイラがあって、すっげぇコンパイル時間がかかって即座に捨ててしまった。

__笹田__　中学校の部活とかは？

__田中__　よく覚えてません。ライトノベルを読むようになったのはそのころだった気がしますが。

__笹田__　本は好きだった？

__田中__　ライトノベルを読むようになって、いまだに読み続けてるわけですが、あんまり広い範囲は読んでません。まぁ、漫画も読みますが。

__笹田__　工業高校に行ったのはその分野が好きだった？

__田中__　あんまり気にしたことがなかった。親の影響だったかな。そのおかげで色々と知ってるわけですが。

__笹田__　北陸に行ったのは？

__田中__　その前の大学時代の思い出は、私は江渡さんと違って普通の学生でした。真面目に授業に出ていた学生を普通の学生というかは微妙ですが。コンピュータ関係で感動したことで覚えているのは、コンピュータの授業じゃなくて、電磁気の授業で、マックスウェルの方程式があって、これを差分的に変えると、どれかの式が、たとえばある点の電位が4近傍の平均になる、という式になるんですよ。そうしちゃうと誤差が入っちゃうじゃないか、とか疑わしく思いながら授業を聞いてたわけですけど。それからいきなり表計算ソフトが出てきて、すべてのセルに4近傍の平均である、という式を放り込むんです。それで再計算を繰り返していくと、出るわけです、電位分布が。おー、と思って。これは感動した覚えがあります。

__笹田__　大学は情報系？

__田中__　電子工学科。弱電。電気の話とか、フーリエ変換とか、回路とか。情報に行ったのは大学院で。結局その大学院に行ったのが情報系に行くんだという決心ですかね。なんとなくそういうふうにしようと、大学3年生のときに思い立って[JAIST](http://www.jaist.ac.jp)に飛び級で行きました。

__笹田__　決心ってのは？

__田中__　ただ単にソフトウェアをやりたいってことですかね。それ以上の理由はなかったと思います。それは今のところあってる。

__笹田__　電子系の卒論とか書いた？

__田中__　それは書かなかった。一応3年の終わりに研究室を選ばないといけなくて、その研究室が4年になる前に軽いゼミをやって、日本語の本を一冊二冊読んだ覚えがあります。そこは信号処理やってました。

大学時代だと、他には計算機センターの補助員のバイトをしていて、計算機のお守りをしていました。その時代から、fj に参加した。それからは fj に少し記事を書いていたりしました。

__笹田__　で、fj で育っていったと。

__田中__　そうね。そのころの思い出は何かな。授業で UNIX を使うというのがあって、はじめての授業でみんなでサーバにログインする、と。そのときにある人数以上ログインできない、というトラブルがあって、そのときに居合わせて問題を同定したという思い出があります。ありがちな話なんだけど、pty が足りなかった。クラス全員分の pty はなかったわけです。それを作るには MAKEDEV という shell スクリプトを実行しなければいけなくて、それをどうやって呼び出すかというのが問題になった。MAKEDEV の中は非常に難しいコードが書いてあるんですね。16進の計算を shell スクリプトで無理やりやってるので、tr とかを使った非常に難解なコードになっていて、そこに苦労して読んだ覚えがありますね。まぁそれは解決して。思い出はそれくらいかなぁ。

### JAIST 時代

__田中__　で、JAIST に行って、まあ JAIST っていう大学院は教育に力を入れているということになっています。つまり、遊んでると卒業できないわけです。ドクター (博士後期課程) だとまあともかく、マスター (修士課程) はようするに、学部とおんなじ様なスケジュールで、毎日毎日授業があると。だから、やっぱり真面目に授業を受けて、それなりに単位を取って、で研究室に行って、まあ研究をして、fj に関わりつつ、マスターを出たと。

__笹田__　修論とかっていうのは。

__田中__　拡張可能ななんとかってやつ[^7]ですね。

__笹田__　渡部先生[^8]のところに、すぐ行ったんですか、配属。

__田中__　俺の頃は一年生の終わりくらいに配属でした。たしかもうちょっと早めようかという話がありましたが、今は早まったのかどうかは知りません。まあでもその頃に行って。

__笹田__　聞いてる感じだと fj とかってなんかシステムよりのことに興味があるのかなあと思ってたら、理論的な話ですよね。

__田中__　なんで？

__笹田__　え、渡部先生そうじゃないの？

__田中__　あのひとは両方やるんですけど。

__笹田__　そうなんですか。

__田中__　理論のこともやるし実装もやるし。両方やる人ですけど。

__笹田__　そこを選んだ理由は何なんですかね。

__田中__　選択肢として何がよかったか、何があったかですかね。ああそうか、そもそも、グラフィックスに興味を持っていたのに、なぜいつの間にか言語になったのかっていう話をしませんでしたね。

それはですね、グラフィックスの記述言語に興味を持った。3D のモデルを書かないといけないじゃないですか。まあ書こうと思ったわけです。でも 3D ってよくわかんないし、だから二次元のやつを探したんですね。でそのときにめぐり合ったのが何だったかっていうと、PostScript だったんです。PostScript はまあ二次元の絵を書く言語で、でまあ要するに Forth なんだけど、スタック型言語で、でそれあたりからですかね。言語のほうにずれていったのは。

__笹田__　それはいつごろですか。

__田中__　これはいつだろう。多分高校だと思いますが。

__笹田__　高校で PostScript ですか。

__田中__　うん。べつに PostScript 書ける人そんなに珍しくなかったですけど。少なくとも JAIST の研究室では何人もいたし [^9]

__笹田__　まあ高校生ではあまりいなかったんじゃないですか。いました？ 周りに。

__田中__　わかんない。

だからそのころに、Ghostscript のかなり低い version のやつを持ってきて試したりとかやってましたね。

__笹田__　高校時代。

__田中__　これは高校だったと思います。あるいはもしかしたら大学に入ってからかもしれない。

__笹田__　だからあとで日本語化の話を。

__田中__　いや日本語化は、もちろん GS に興味を持っていたっていうのは事実なんですが、私自身は開発はしてなくて、っていうか GS の日本語化もしくはその類の話は何人かがやっていて、GS version 2 の頃に NACSIS の片山さん[^10]っていう方がけっこうやっていた。で、ところが maintainance が途切れてしまって、それをもうちょっと新しい version に適用できるようにしたっていうのが私ですね。あとは、なんかあのへんは錯綜してて、VFlib を使うための patch がなんか別にあったりして、そういうのをまとめたっていうか取捨選択して、自分が欲しいところだけを取り出して patch をまとめたっていうのをしばらくやっていた。逆に言えば GS のバージョンが上がらない限りは何もしなくて、まあちょっとはコード書いたんですけど、まあたいしたことはやらなかったですね。

まあそのときの苦労もあってですね、日本語化はいろいろ虚しいことが多くて。虚しいというか苦労が多くて、あまりやりたくないなあと思ってます。あとは本家に feedback することが重要だってことですか。local でやってると手間ばっかかかってしょうがない。本家に放り込んでしまうのが最終的には一番幸せ。

__笹田__　えと、言語の話から飛んだんですけど、じゃあ大学はいる頃からもう言語とかじゅうぶん興味があった、と。

__田中__　あった

__笹田__　でまあ JAIST のほうに。言語がやりたくて行った？

__田中__　そのころはそこまで明確ではなかったと思いますね。ソフトウェアの講座で、JAIST も別にソフトウェアばっかじゃなくて、理論とかアルゴリズムとかもありますし、音声認識とかそっちのほうもありますし、まあもちろんソフトウェアもあります。でそういう中ではソフトウェアがが前提なのは確かでしたけど。その中でどれをっていうのは、いろんな可能性はあったと思います。たとえば渡部先生のほかの可能性としては二木先生[^11]とかあるいは中島先生[^12]であったり篠田先生[^13]であったり、いろいろいましたけど。

__笹田__　わからないですすいません。

__田中__　えっと、二木先生って分かります？

__笹田__　すみません、わかりません。

__田中__　{% isbn('4756100503', 'オブジェクト指向入門') %}って本知ってますか。Meyer の。あれの監訳なんですけど。さらにいえば電総研の OB で。あと二木渡部研の大講座制だったんでゼミとかやりましたけど。

他には中島先生は今早稲田ですけど。あと篠田先生って有名じゃありません？

__笹田__　へー。

{% isbn_image_right('4894712059') %}{% isbn_image_right('4894712571') %}
__田中__　あるいは片山先生[^14]、落水先生[^15]、たとえば落水先生は {% isbn('4893620290', 'UNIX C SHELLフィールドガイド') %} って本知ってます？ あの本の訳者だったかなんだったか。なんとかの本といえば篠田先生が、Stevens の本がありますよね、ネットワーク系のやつが何冊か。{% isbn('4894712059', 'UNIX Network Programming vol. 1') %}, {% isbn('4894712571', '2') %} とか。あれの訳者だったり。

__笹田__　ネットワーク技術やってる田中さんって想像できませんね。

__田中__　そう？ ネットワークはそこそこやっている気がしますが。今でもたとえば UDP が云々とかやってますよね。

__笹田__　まあたしかに。なるほどね。

__田中__　ネットワークプログラミングは、今でもします。あるいは、五月雨だってネットワークプログラムですよね。べつにそんなにやらないっていう話じゃないですね。kernel 内を弄ったりはしませんが。

__笹田__　そんなんで、再構成可能な何とか。

__田中__　拡張可能な何とかっていうのをいろいろ、拡張可能な言語であったりシステムであったり。まあアーキテクチャを。そういうお題目で研究してました。

__笹田__　修論でそれやって、ドクターでも。

__田中__　笹田さんのようなものとは違って[^16]、何も外に出てなくて何の役にも立ってないんで。

__笹田__　PRO[^17] かなんかに出てませんでした？どっかで論文見ましたよ。

__田中__　出したけど落ちたんじゃなかったかな。

__笹田__　研究会報告、ああないのか PRO は。

__田中__　うむ。PRO は確か一回出したけど落ちた。

__笹田__　PDF でどっかでみたのかな。

__田中__　まあ多分どっかに落ちてた気はします。あとなんかの研究会には出した覚えがあります。でも結局、世の中へのインパクトはないんで。

__笹田__　パッチとかバグレポートとかやってた時期はドクターの頃？

__田中__　ドクターですね。ドクターも確かかなり後のほうな気がしますが (笑)

__笹田__　研究もやらずにそんなことばかりやってたというふうに、口悪くいうと。

__田中__　そうです。よく言えば就職活動してたというか。その頃はそんな可能性があるとは夢にも思いませんでしたが。

__笹田__　まあ好きにソフトウェア書いてたってことですかね。

__田中__　ですかね。といってもソフトウェアねえ。

__笹田__　マスターの頃とかってずっと勉強ばっかりで書いてなかったんですか。

__田中__　いやそんなことはないと思いますよ、プログラミングをやめるほどの根性はないから。でも、外に出てきてるものってない気がしますね。

__笹田__　たとえばマスターの頃って何やってたんですか。

__田中__　ちょっと覚えがないなあ。記憶が。まあでもいろんなものをインストールして試すとか、そういう普通の、普通かどうか知りませんが。

__笹田__　なるほど。

__田中__　まあ周りの人に影響されるたちもあるので、守岡さんや小林君に影響されてメール関係を考えてみたり。そんでもって RFC を読んでみたり。

__笹田__　そのころにどんどん知識を付けていったと。

__田中__　ですかねえ。まあ RFC を読むっていうのはいろいろ、fj で議論するためにも重要なんですけど。

__笹田__　なるほど。

#### 実は [RFC1468](RFC:1468) にはバグがある
![akr10.jpg]({{base}}{{site.baseurl}}/images/0008-Hotlinks-2/akr10.jpg)

__田中__　RFC1468 は、ああ結局、改定されなかったなぁ。

__笹田__　1468 って何？

__田中__　ISO-2022-JP。あれにはバグがあってですね、空行が書けないんですけど、それを見つけて。
正確にはエスケープシーケンスがない行を書けないんだったかな。

fj で、end 行の問題があったときに、って言ってもわかんないか。end っていうだけの行があると、たしか Outlook Express でその記事が読めないという問題があったんです。でこれはなんでかっていうと、end っていうのは uuencode の終わりで、それを detect してなんか変に動くが故にですね、記事が読めないという。でまあその頃に、それは Outlook Express が悪いのか、あるいはそれを書く人が悪いのかという議論が盛り上がってですね。その議論自体には関わってなかったんだけど、それと同時期に、end 行っていうのは RFC1468 を字面通りに解釈すると invalid なんですよ。正しくない。だから書いてる人が悪い。Outlook Express は悪くない。という、論陣を張るというほどではなかったんだけど、その可能性を指摘して、RFC1468 について、BNF とは何かというところから議論した覚えがありますね。

他には MIME がどうこうとか。encoded word の話はずいぶんやりましたね。encoded word はすごく難しいので。まあでもそういう難しいことはあんまり意味がないんで、机上の空論に非常に近く……ああそうだ。だから encoded word については、それの正しい decoder を作りましたね。規格的に正しいところに出てきた encoded word だけを decode するという。この結果が何かっていうと、普通の人が encoded word だと思うところがかなり decode されないんだけど、そういう不幸な、でも正しい decoder っていうものを作ってみました。

__笹田__　なるほど。あれはバグだよと指摘。

__田中__　バグ。何のバグなんですかね。

__笹田__　仕様。っていう話じゃないの？

__田中__　いやこれがまあ、いろいろ選択可能にしたんで。なんでもかんでも decode すればいいので、まあそんなに難しくはないっていうか、それで誰かを非難するっていうことはなかったかな。

__笹田__　まあなんか、そんな大学院生活だったと。

__田中__　うむ。

#### 使いやすさについて (2)

__笹田__　言語処理系の興味としては、言語処理系じゃないですね、言語としての興味としてはどんな感じだったんですか。

__田中__　PostScript をはじめとして、いろんな言語を調べたりして、で、渡部先生の、っていうか研究室も言語設計学講座ってやつで、まあ言語の講座で。でそこでしばらく Scheme を使って、拡張可能ななんとか。拡張可能な言語とかをやってました。

__笹田__　なるほど。

__田中__　まあでも、自作の言語を作るまでには至らず今に至ってますが。

__笹田__　つくろうとはしてた？

__田中__　いやあんまり。拡張可能っていうほうに行ってしまったから。なんかベースがあって、何か追加すれば何でもできますというアーキテクチャなわけです、拡張可能システムっていうのは。でもまあ、これはちょっと反省点でもあるんですけど、実際使えるところまではだいたいたどり着かないんですね。それに、簡単なものを作るだけで済ましてしまうし。なので使えるところまで行かなかったんで、言語設計っていえるようなものを結局は経験しませんでした。

__笹田__　反省点っていうのはやっぱり使えるものを作ってなんぼだよなっていう話？

__田中__　いやまあ、んー、これは Ruby に関わって考えたことなんですけど、「拡張すればできます」ではまだダメで。原理的にはできるはずだではダメで、ちゃんと使えて、使いやすくなければならないという。で、そのためにはちゃんとやんなきゃね、っていう。まあそれだけの話なんですが。

さらには、もうちょっと強い考えとしては、拡張可能システムっていうのはもしかしたら、よいものを作るためには邪魔かもしれないという疑問もあります。これはなぜかっていうとフィードバックが得られにくいという可能性があるためです。つまり拡張可能だと、いろんな人が個人でどうにかしちゃって作者のところに要求が来ないので「みんなで共通して使うためには、どういうものがよいものか」っていうのを作者が知る機会が減ってしまう。

__笹田__　え、じゃあ Scheme はダメなの？

__田中__　そういう意味ではそうかもしれない。つまり低レベルな、特に [SRFI](http://srfi.schemers.org/) とかが出る前の Scheme は非常に primitive で。

__笹田__　みんながみんな自分のものを作っていた、と。

__田中__　毎回みんな苦労する。でもそうじゃなくて、もっと使えるものを最初から付けとけという。まあだから Scheme の人に喧嘩売ってるような感じですが (笑) 拡張可能なだけではダメかなと。

__笹田__　ちなみに拡張可能なシステムっていうのは、その研究自体は、既存の言語に対して何かする、という話だったのか、それとも？

__田中__　私がやったのはもっと、こんなふうなアーキテクチャにしたらいいんじゃないですかっていう感じです。特に reflection と絡んでいたので、meta-level アーキテクチャとか、そういうのをもうちょっと具体的に、言語に適用してこういう風にしたらいいんじゃないでしょうか、まあそういう話だけどまあ、あんまり聞かないでください (笑)

__笹田__　黒歴史？

__田中__　まあ、それに近いかな。

__笹田__　ええとじゃあ大学はそんな感じで。修了されたという。

__田中__　そうね

#### Mule にバグ報告をしていた頃からすでに田中さんは報告するだけで fix しない今のパターンを築いていた

__田中__　まあなんとか出させていただいて、でまあ、その次が産総研ですね。ああだからそうか、なぜ産総研に来れたのかという問題はありますね。まあこの件に関してはインターネット上の活動が原因になってまして。

Mule というソフトウェアがあるんですが、どういう順番だったのかはちょっと覚えてないんですが、Emacs 関係の話をやっている守岡さん[^18]と小林君[^19]という人と、よくつるむようになった。でまあいろいろ議論したり、さっき話[^20]に出てきた CHISE の原型になる話を議論したり、まあ俺はあんまりたいしたことやってないんですけど。で Emacs 本体にも絡むことがありました。Emacs っていうか Mule 部分に、少し顔を出すようになってきた。

で、そのときに、たしか Emacs の、たしか 20.3 に対して、バグの鉱脈を見つけたんですね。鉱脈って言うかな、まあ Ruby にもあるんですけど様々なバグが発生するようなアーキテクチャといいますか、そういうものがある、っていうことを発見して、で大量にバグレポートを送ったんだよね。でこれは Mule のバグなんで、送り先は mule-ml ってやつで、これはどこでやってるかっていうとつまり戸村さん[^21]、つまり、産総研でやってるわけですね。

__笹田__　もう産総研になってた？

__田中__　電総研だったかもしれない。ああ電総研だったと思います。で、電総研でやっていて、そこに大量にバグレポートを送ったと。で半田さん[^22]に fix してもらいつつ、半田さんが fix すると次のバグを送るということをしばらくやって、まあその頃からつまり、私自身は fix をしないという話だったのですが、大量のバグレポートを送っていたら向こうからお誘いが来て、でとりあえずは非常勤職員としてしばらくいました。でもうちょっと経って、機会があったときに滑り込んだと。

そのときのバグは byte combination ってやつで、これは Emacs が落ちる類のバグなんですけど、これの経緯に関して話すと、Emacs の 20.2 まではですね、buffer っていうのは byte の並びだったんですよ、だから、1byte 目、2byte 目、3byte 目……ってあったんですけど、あるとき Stallman がこれを一文字単位に変えたんですね。一文字っていうのは Mule には internal encoding っていう state-less な encoding があって、それでの一文字なんですが、にもかかわらず buffer は任意の文字列を保持できるというふうにしたんです。

つまり internal encoding としては invalid なものも buffer に放り込める。放り込める挙句にそれを無理やり文字っぽい単位で判断して動く、という非常に不明瞭な、つまり文字としてあんまり正しく解釈できないものを無理やりなんとなく文字っぽいものとして無理やり解釈した上でその操作を行うというアーキテクチャなんです。で、それを扱う側のコードはちゃんと文字になってる場合しか考えていないことがあって、そういうコードにちゃんとした文字じゃないものを扱わせようとすると非常にへんなことが起こる。でそこを突くと、まあ落ちるわけですね。たとえば文字数と byte 数の対応がなんかずれると、buffer の後ろのほうが壊れたり、まあ非常にひどいことが起きて。

これが、そういう性質をすべての primitive に対して全部完全にやらないと落ちないようにならないという不幸な、不幸なんだけど Stallman がやったからしょうがなくって。でこれが安定化するまでにどんぐらいかかったのかなぁ。半年だったか一年だったか。

__笹田__　でもそんなんで収束したんですね。

__田中__　いやまあ、あの連中は (笑) なんとかするんですよ。Emacs はすごいですよね。腕利きがそろっていて。

__笹田__　やっぱりそうなんですか。

__田中__　守岡さんに言わせるにと、Emacs は腕利きがたくさんいてやってる。XEmacs は凡人がまとまってやってる。って言ってました。俺が表現すれば Emacs は要するに奇跡が連続して起きているような、そういう開発体制みたいに感じます。

__笹田__　へー。

さっき ISO-2022-JP が云々って話をしておられましたが、それはそのまま Mule でバグレポートする話に繋がっていくんですか。

__田中__　前提知識としてはありますけど。

__笹田__　興味として？

__田中__　まあ文字コードの話とか知ってるとまあいろいろと、便利というんですかね、いろいろなところを突くのに必要だったりしますが。たとえば ISO-2022-JP の構造を知っているから見つけられたバグとかもあるにはありましたけど、そういうのは少なかったですね。

__笹田__　なるほど。興味としては別に多言語化がどうのという話では。

__田中__　それはないですね。ないっていうかまあ、あんまり気にしない。まあもちろんハートマークを使っていたあたりには、名残はあったわけですが。

__笹田__　なんですかハートマークって？

__田中__　あー。ハートマークって言うのは JIS X 0208、普通に使ってる日本語の漢字コードには入っていない文字なんです。でもまあ、使いたいわけですよ。で、その代わり何が使えるかって言うと、韓国の文字コードがあって、そこには入っている。

で、ISO-2022-JP-2 ってやつがあって、そこでは韓国のと日本語のとあとなんだっけ、中国のとギリシャ語と、まあそういうのを使えるやつがあって、まあだいたい ISO-2022-JP と同じなんで、JP-2 をちゃんとサポートしてなくても日本語の部分はだいたい読めることが多いので、ハートをちょっと埋め込んでおくには便利というか使えるんです。で fj とかでも、ハートが読めてるかどうかは知りませんが、JP-2 で書いても日本語の部分は伝わるので、ハートを書いてもそんなにトラブルにはなんないわけですね。少なくとも私が使っていることに関して文句をいう人はあまりいなかったので、ハートをそれで使ったり。

っていうか、signature は、あれは全部ハートが入ってるんですけど。

__笹田__　「ふえろ! わかめちゃん作戦です$(C⊇」とか？

__田中__　そう。あの引用の$(C⊇は全部ハートが入っていて。

__笹田__　へー。

__田中__　だからそういうものを選んであるわけですけど。まあそれも、いつしかやめてしまいましたが。

__笹田__　ハートっていうと Macintosh の Shift-JIS 体系にはハートがあったとか。

__田中__　まああってもおかしくはないけど。

__笹田__　私はその話しか知らなくて。

__田中__　今 0213 にはハートは入ってますね。

__笹田__　0213?

__田中__　新しい漢字コード[^23]。日本のやつ。あでも、0213 使えるのかな。

__笹田__　これから使えるようになっていくんですか。

__田中__　さぁ？それはどうなんでしょう。よくわかりません。

__笹田__　なんか私の家族がね、なんで音符は使えるのにハートは使えないんだ、って。

__田中__　うーん。どうなんでしょう。いや Unicode に入ってるから、まあべつに。

__笹田__　普通 Windows では出せないから。ハートって。変換して。

### 産総研

#### CVS ネタの未踏でやったこと

__笹田__　で、産総研にめでたく。あっと、電総研でしたね。

__田中__　うむ。まあ。

__笹田__　で、非常勤で入られて。未踏で CVS やったのは。

__田中__　それはもうちょっと後、ああ、すぐかな。まあ一年目か二年目のときですね。今の cvs.m17n.org っていうのは、もともと JAIST 時代に守岡さんが始めた chamonix.jaist.ac.jp ってやつで、これはようするに守岡さんが使うため、もしくは他の人と共同して開発されるために運用していたものです。で、守岡さんはその後、これまた戸村さんに誘われてしばらく電総研にいたわけです。その後京大に行ったんですけど。で電総研時代に、cvs.m17n.org っていうのを電総研ではじめて、それを引き継いでメンテナンスしているのが私。という状況です。引き継いでっていっても中身はほとんど完全に作り直したんだけど、そのときの経験がすごい大変だったので、もうちょっと普通の人にもできるようにしようよ、っていう題目で、未踏をちょっとやってみた。

__笹田__　なるほど。

__田中__　まあお題目はいいんですが、まああんまりうまくまとまらなくて、唯一うまくできたと思ってるのは commit のたびにメール送るシステムですかね。個人的にはあれはうまくできたと思ってます。

__笹田__　あれってそんなに難しいことですか。

__田中__　それは条件によるわけですけど。[chroot(2)](http://www.freebsd.org/cgi/man.cgi?query=chroot&sektion=2) して、内部に Ruby とかのインタプリタがなくて、という状況だと難しい。

__笹田__　chroot?

__田中__　あーだから、CVS って信用できないわけですよ。信用できないことがはじめっから分かってるから、なんか他の変なプログラムを実行されては困る。だから、変なプログラムは、とくに Ruby みたいな何でもできるプログラムは置きたくない。だから Ruby スクリプトでやるのはちょっとまずいわけです。かといって C で書くのはきつい。じゃあ何で書くかというところで迷うわけですが。つまり、native code が生成可能な言語処理系で、かつまあ比較的まともな、まともなっていうか、たとえば buffer overflow とかが起こらない、という条件が必要で、結局 [ocaml](http://caml.inria.fr/ocaml/index.en.html) を選んでそれで書いた。

__笹田__　へー。

__田中__　まあ、これはいまだに動いているし、個人的にはうまく書けたと思ってるんですが、まあでもあんまり万人向けというところまではいかなくて。

__笹田__　ようするに CVS で開発したい人のためのっていう、ノウハウ集、っていうお題目だったんですよね。

__田中__　もうちょっと広くて、たとえばそれを make install でできればいいなあと思ったんですが、まあそこまで行かなかった。

__笹田__　CVS に限った話ではない？　そうでもない？

__田中__　いやこの件は結構 CVS に依存した話で。たとえばそういう CVS から呼び出す chroot の中で動けるプログラムとか、あるいは CVS にちょっと patch を当てて、変更して何かやるとか。そういうやつですね。だからまあ、これは CVS そのものの話でした。ただあんまりうまくはいかなくて、そのメールを送るところ以外はほっぽってあります。すいません。

__笹田__　未踏のはそんな感じ、と。

#### プログラミング言語 MixJuice

__笹田__　であわせて [MixJuice](http://staff.aist.go.jp/y-ichisugi/ja/mj/)。

__田中__　しばらく MixJuice の周辺作業をやってましたね。あれでいちばんでかかったのは、MixJuice 版デザインパターンっていうやつです。MixJuice の処理系には手を出さないで、ユーザーとしての話ですが。まあデザインパターンっていうのは、要するに書くのが面倒な、あるいは思いつき難い書き方なわけで、それを MixJuice でやるともっと簡単に、あんな難しいことをせずに同等な効果が得られるっていう話を GoF[^24] の 23 種類についてやってみたというものです。あれはどうなのかなあ、特に反響は聞いたことがありませんが。

__笹田__　その研究自体はどうだったんですか。どうだったというか、田中さん的な評価は

__田中__　あれは自分としては結構うまくいったとおもってますよ。予想されていたけれども、実際にどういう風に MixJuice みたいな機構を、まあ今流に言えば AOP 機構をどうやって利用するかっていう形を示せたと思っています。

__笹田__　研究の主題は、実装をどのようにするか？　言語デザインの研究？

__田中__　あの話では、既存の MixJuice っていうのを前提にしたから、「こういう機構があればもっと簡単に書けるのに」っていう話はないですね。「MixJuice みたいなのがあればこのぐらい簡単にかけます」っていう話をしました。

__笹田__　田中さんの仕事はそうなんだけど、その MixJuice というもの自体。

__田中__　MixJuice というもの自体？　それはどうなんでしょうね。それはなんか先行きはあんまりなさそうですけど。数多くの様々な言語と同様。

__笹田__　田中さんみたいなそういう人から見てどうだったのかっていうのが気になるんですが。

__田中__　なにが。

__笹田__　なんだろうな、田中さんの興味というか。

__田中__　MixJuice そのものはいいと思いますよ。いいっていうか、言語処理系というよりは、メソッドのスコープの話は非常に興味深い。だからまつもとさんが selector namespace がわかんないとか言ってるけども、MixJuice 流の考え方でよければ実現例があるんだからいいじゃんとか思っています。

__笹田__　Ruby で実装できるもの？

__田中__　もし selector namespace をああいう機構だとすれば理解するのはそんなに難しくないと思ってますが。単に、class とは直交して namespace があって、メソッドは namespace に属して定義されて、定義の属する namespace を参照している namespace の中でだけ呼べるというだけの話ですが。で、同名のメソッドがあっても定義している namespace のひとつだけを参照している限りは問題なく (参照しているほうを) 呼べる。複数参照している場合はあいまいなので、呼ぶにはどれかを指定しないといけない。

__笹田__　そんな話なんですか。

__田中__　まあ基本的にはそうですね。

__笹田__　いや selector namespace ってやりたいことっていうのは

__田中__　ああ、たとえば [jcode.rb](ruby-man:jcode.rb) は嫌だよねっていう話があります。これは、jcode を使いたくないのに、誰かが require したとたんに、問答無用で jcode のメソッドが使われてしまうことですよね。でも、selector namespace があれば、jcode を使ってるところでは jcode のメソッドを使って、使ってないところでは元のが呼び出せるからとくに問題ない。

__笹田__　それをどう切り分けるかっていう言語デザインとそれをどう実装すればいいかっていう話か。

__田中__　そうですね。まあ仕様のほうはそれに関して言えば MixJuice ではできていたので、別に仕様の定義はいいんじゃないのと個人的には思うわけですが。でも selector namespace に関してまつもとさんが毎回毎回わかんないわかんないって言うので、まあいつまでたってもわかんないんじゃないでしょうか。

__笹田__　いってあげればいいじゃないですか MixJuice 読めって。

__田中__　それは向こうも知っているのです。

__笹田__　知ってる上でわかんない。

__田中__　知ってるっていうか、「MixJuice を調べればいいんだけど」とか言ってるの。

__笹田__　調べてないんですか。

__田中__　さあ知りませんが。想定されているのは MixJuice みたいなものではないのかもしれない。まつもとさんが考えてるものが。それは俺にはわかんないんだけど。

__笹田__　なるほど

#### 使いやすさについて (3)

__笹田__　田中さんがよくおっしゃってるのは、さっきの話にもありましたけど、ライブラリに関するインターフェースっていう話はよく言いますよね。

__田中__　言いますね。

__笹田__　いやまあ (笑) それは自分の興味というかそういう話を聞きたいな、と。

__田中__　自分の興味というか。

__笹田__　田中さんの研究のテーマはそういうことなのかなぁ、と。

__田中__　まあ少なくとも論文にまとめているかといわれればまとめていない。興味を持っているのはそうなので、いつか書ければとは思うけれども、今のところは遠い話かな。それにそもそもどうやったら論文にまとまる話なのか良く分からない。

__笹田__　そういうのに興味を持った発端とか。Ruby を見て？

__田中__　うん。だから Ruby に非常に大きな影響を受けてますね。その件に関しては。

__笹田__　Ruby のライブラリかいてみようとしたらとか？

__田中__　なんでしょうね。以前はできるかできないかしか意味がないと思っていんです。ちょっとオーバーないいかたですが、可能だったら後はどうでもいいという感じで。アカデミックにはできるかできないかのみが重要な事も多いので、そっちに偏っていたわけですね。でも、そうじゃなくて、できるという中にも簡単にできるとの大変なのとすごい苦労するのとあって、そこを気にしないといけない、ということを明確に気にするようになったんです。これは Ruby の影響ですね。

で、自分が影響されたんだけど、まああんまり影響されてないような人も見受けられるというのも事実で、繰り返し言いたくなる原因なわけですけど。

__笹田__　じゃあ研究自体はそういう話じゃないのか。

いや、産総研でどういう立ち位置なのかな、とか。

__田中__　産総研における立ち位置ってなんか、まあ、なんとなく立ってる

__笹田__　(笑)

__江渡__　採用の時にはなんていって採用されたんですか。

__田中__　非常勤としての採用の時にはないんですよ、何にも。予算さえあれば採れたんです。今年からはちょっと何か公募を通さないと取れないんですが。

で採用、常勤になるときには、拡張可能システム云々ってやりましたよ。

__笹田__　D 論の？

__田中__　まあ D 論と、二年間一杉さんと一緒にいたから、まあそのときのことも含めて一杉さんにいろいろと指導してもらってですね。

#### 言語の進化はいかにして加速されるべきか

__田中__　ようするに、言語の進化って凄い遅いと。現在主流な言語を Java とすると、その前は C で、さらにその前は Fortran とかなわけです。それぞれ 10 年あるいは 20 年の時間ですよね、一世代。それは新しい機能をいれるには遅すぎるというわけです。GC とか、研究やマイナーな言語にはもうずーっと前からあるのに、やっと Java で入ったって感じ。ちょっと遅すぎるので、もっとスピードを上げましょうと。上げるにはどうしたらいいかっていうと、もっとお気楽に変えられなくちゃいけない。なので拡張可能言語が重要だね、っていうストーリーをプレゼンしました。

__笹田__　おー。なるほどぉ。

__田中__　でもね (笑) まあなかなか難しいところで。

__笹田__　それを Ruby でやってるの？

__田中__　どうなんでしょうね。言語の進化って意味では、少なくとも Ruby に関して言えば拡張可能にすることによって進化を加速させているのではないですね。たとえば、まつもとさんは % 記法を拡張可能にすることを必ず拒否するとか。ならどうやって進化させているかと言うと、いろんな人が議論しながらひとつのものを進化させてるわけですね。だからそういう意味ではプレゼンしたようなモデルで言語の進化に関わっているわけではない。ただ、私が Ruby というひとつの言語の進化に関わっているのは確かなんじゃないかなあ。まあ少なくとも変化には関わってます。stdio を捨てるとか。あるいは open-uri は喜ぶ人が多いので、アレを進化と呼ぶのであれば進化かもしれない。

__笹田__　バグフィックスは進化とは違う?

__田中__　バグフィックスは進化か。普通は進化とは言わないんじゃないですかね。まあただ、バグの鉱脈がある時には、たまに全部潰すときに必要上進化することがあります。

__笹田__　callcc とか？

__田中__　callcc はどうかなあ。例としては 1.6 の頃に Marshal が原因となって core を吐くのを大量に報告した覚えがありますね。で、その結果何が起きたかって言うと、Allocation Framework が入ったのがあるんですけど、これは比較的明確な進化ですね。

最近の話で finalizer のタイミングがずれたっていうのが。あれは進化かって言われるとちょっと微妙ですが (笑) まあ shiro さん[^25]に言わせれば Boehm の論文がある[^26]って話だから、論文と同じくらいの新規性があるのかもしれませんが。

__笹田__　何の話でしたっけ。

__田中__　えーとだから finalizer を GC の時点で動かすのは凄い危険だっていう[^27]。

__笹田__　あー、はいはい。え、ずれたの最近でしたっけ。

__田中__　最近ですよ。私が提案したので覚えてますが。([ruby-dev:24354](http://blade.nagaokaut.ac.jp/cgi-bin/scat.rb/ruby/ruby-dev/24354))

言語の進化ねえ。だからそういう風によってたかってやるのと、拡張を可能にしてみんなが個々にやるのとどっちがいいのかねえ。というのは微妙なところではあります。

__笹田__　拡張可能なのをみんながよってたかってやるのは……なんか発散しそう。

__田中__　うんそう、よってたかってやる必要があるのかっていう問題がありますよね。だって別にある人が拡張したからって、それが気にくわなければ使わなければいい。でも Ruby に俺が変更を加えると、それを使わなくていいわけにはいかないよね (笑) いかないので、議論を巻き起こすもしくは議論に巻き込む効果はあります。だからちゃんと興味がちょっとでもあるやつをかき集めて議論する意味はある。拡張可能だと、気に入らない人は発言しないかもしれない。

__笹田__　拡張可能なことと Lisp のマクロが云々って言う話とは関係ない？

__田中__　もちろん関係あります。Lisp の macro も含めて、作れば何でもできますっていうのはそのとおりなわけです。でも、みんな自分で作って自分だけで使うというのは不幸なわけです。でも、とくに簡単に作れるものに関してはそうなってもおかしくない。まあ作るのは大変なやつは共通化していくでしょうけど。でも、簡単に作れるものだって、やっぱり共通化は重要で、そういう方向性を推奨もしくは強制するようなフォースが重要かも知れない、という話なんです。まあ強制しすぎると耐えられない人もいるんでなんですが。

__笹田__　じゃあその辺のバランスを何とかしたいっていう感じなんですかね、目標は。

__田中__　バランスっていうのはどういう風にとったらいいんでしょうね。まあでも、別に完成したものを一個作るというのではなく、成長しながらバランスをとっていくというのが現実的ですかね。つまりソフトウェアは成長していくんだと思えば、ある時点で完璧なのを作らなくてもいいかな。不満があるんであれば、あるいは迷いがあるんであれば、そこは実装しない、機能不足にしておくとか。できなくてもいいと。あとで誰かが要求してから作ればいいとか、あるいは要求されてから議論すればいいかと。やや乱暴な話かもしれませんが。

いやまあ実際、仕様を早く決めすぎるっていうのは非常に怖くて、微妙なところの仕様って決められないんですよ。用例が見つからなくて。たとえば Ruby でいえば [IO#read](http://www.ruby-lang.org/ja/man/index.cgi?cmd=view;name=IO#read) の引数に 0 を与えたときに、これは nil が返るべきか空文字列が返るべきか。っていうのは、実例がなかなかなくてなかなか判断できませんでしたね。まあ ML を探しまわって結局二つ例を見つけたんですが。だいたい read(0) って、0byte 読むってことだけど、そんなことやんないじゃん。少なくともリテラルで 0 ってそこに書く人はまずいないわけ。そんなことをしても何も情報は得られないから。でも 0 を渡せるのが有用であることは実はあって、たとえば CGI で Content-Length の数値をそこに渡すとか。ここで Content-Length: 0 っていうことがあるわけで、このときにはどっちがいいかっていうと、これは空文字列のほうがいい。つまり 1 以上だったら文字列返ってくるから、0 のときだけ nil が返ってくるというのは普通気がつかなくて間違いの元なわけです。だからこの例では read(0) は文字列のほうが良い。

これとおんなじ様な話が Marshal の内部でも実はあって、やっぱり「長さ指定 + 文字列」っていうときに、長さが 0 のときに、文字列が返ってきたほうが便利。で今のところ nil が帰ってきたほうが便利っていう例は見つかってない。

でもこれ、メーリングリストとか探し回ってさ、ウン年分あってもさ、たった 2つよ。こんなの最初に設計したときに判断できるわけなくて、そういうことを思うと、まあ変わっていくしかないかなーと。あるいはエラーにしておくとか。迷ったら、まあこの場合はちょっと、機能つけないってことはできないから、とりあえずエラーにしておくとか。たぶん最初にエラーにしておけば、あとから変えてもあんまり文句でないと思うから。使いにくすぎてはダメですが、迷うところについては使いにくくしておいてもいいかなぁと。後から使いにくく変えると恨まれるから、最初は使いにくくしておくのがまあ、恨みを買わずに進化させていくことに必要かなと思ってますが。

__笹田__　そういうことを普段なんか研究としてやってるっていう。

__田中__　いやこれは実践ですね。

__笹田__　なんか論文にならなそうな話だなあ。

__田中__　論文ねえ。どうしたらいいんでしょうね、これ。もうちょっと普及して欲しい概念なんですけど。

__江渡__　Java でいっぱい例外とか出るじゃないですか。でだいたい try{} って書
いて catch{} で何も書かずに終えるっていう風にすることが多いんですよ。

__田中__　うむ。checked exception の弊害ってやつですね。

__江渡__　うん。その話を思い出したなあ。ちょっと厳しいようにするのはいいけども、だいたいそういう風に逃げて、何の意味もなくて。

__田中__　だから、よけ方も考えないといけない。たとえば今 [WebApp](http://raa.ruby-lang.org/project/webapp) っていうライブラリを作っていて、form のっていうかパラメータへのアクセスに非常に迷ってるんですよ。CGI 流だとまあなんか Hash みたいな物が入ってやるんだけど、あそこは危ないから、なるべくなら validation 付きでアクセスさせたい。だから validation 付きのアクセスと validation なしのアクセスがあって、validation 付きの方が簡単に呼び出せるようにしたい。

でも validation のほうはまだどういう風に validation していいかっていうのよくわからないから今すぐには実装はできないって言うか、ちょっとやったんだけどまああんまり完璧なものではなくて。でそうすると validation なしのほうを難しくしておきたい。その結果として何をしたかっていうと、すっげー長いメソッド名にしたんですよ。別に意味なく長くしたわけではなくて、application_www_x_... って MIME type が全部書いてあるわけです。すごい長いわけ。get_&lt;MIME type&gt;とか、MIME type すごい長いからでまあこれでいっかと。こうしておけばこれはあんまり使わないでいてくれるに違いないと思っていたらですね、最近 RedHanded で _why が「[こうやって alias すれば短くなりますよ](http://redhanded.hobix.com/inspect/oneSmallServingOfWebappTips.html)」って書いて。

__笹田__　(笑)

__田中__　うーむとか思って。いやあなかなかままならないものだなと、思いましたが。

メソッド名長くするっていうのは、あんまりへんな、checked exception みたいに有害な害にはならないぶんまだマシかな。

__笹田__　へんな alias を作らせるっていうのは有害になる気がしますけどね。

__田中__　まあでも、それは悪い書き方なのね。そのうち validation 付きのよい書き方を設計したいという希望だと思ってください。それに、短くてもいいやと思い直したら、ライブラリが alias を提供してもいいわけですし。そうしても互換性は壊れませんしね。

### 普段の仕事

__笹田__　普段の仕事ってそういうことやってるんですか?

__田中__　普段の仕事ですか。

__笹田__　うん。仕事仕事。

__田中__　こういうことを考えてることもありますしまあ Ruby のことを考えてることもありますし、あるいは職務として委員会とかの作業をやっていることもありますし。まあいまはプログラム委員のことをいろいろやってます。[LC2005](http://lc.linux.or.jp/lc2005/) の。

__笹田__　え、業務ってそういうことなの？

__田中__　業務。うむまあ、ひとつは外に発表することですかねえ。

__笹田__　あーなるほど、研究会とかで発表する。

__田中__　まあそれもそうかな。まあなかなかあんまり output をうまく出せなくて心苦しいんですが、

__笹田__　でもあれですよね、この間高林さんに言われましたけど、私みたいにへんな論文[^28]よりも、ちゃんと Ruby の VM 書いたほうが世の中に役に立つよねっていう話をされたけど、田中さんはまさにそれを地で行ってるわけですよね。へんな論文なんか書かないで役に立つものをアウトプット、コードとして出してるっていうのは。

__田中__　まどうなんでしょうね。

__笹田__　でもそれは業務としての実績にはならないとか、そういうことですよねきっと。

__田中__　まあそこは難しいですね。

そういえば実績って言う程のものではありませんが、産総研では常勤になると、年度末に自分がどんなことをやりました、こんなにちゃんとやりましたっていうことを書かされるのですが、バグレポートの件は書いたなぁ。

__笹田__　一日一件。

__田中__　一日一件じゃないけど、たくさん書いてたくさん送ってこのくらい当たってこのくらい fix されました。確かそのときは 8 割から 9 割くらい当たったのかな。当たったっていうのはそのつまり、それはバグであったってことです。バグレポートが間違っていたっていうことはあるので。まあそういうことをこんぐらいやりましたと。いうようなことは書きましたね。

__笹田__　それ評価されるの？

__田中__　グループの方針次第ですが。うちはされる。てか戸村さんのグループは、フリーソフトウェアもやるというグループなので、それは評価できるわけですけど

__笹田__　じゃあ田中さんのお仕事はフリーソフトウェアを云々って話なんですか。上のほうでは。上の方っていうかグループとしては。

__田中__　それは一部で。去年の初めまでは一杉さんと一緒にやってたんでまあいろいろと拡張可能云々っていうのをやってましたね。で去年の途中からちょっとこっちに来て、しばらくは、BTS の類を作ってまして。これはどうにかしてそろそろ公開したいと。

#### BTS について

__田中__　ちょっと日記に書いたんですけども、まあようするに、プログラムってのは開発しているとたまに壊れたり直ったりするわけですよ。

__笹田__　うん。

__田中__　あるとき壊れたことを発見したらいつ壊れたのかを知りたいじゃないですか。昔は動いたんだから。

もちろん、ソースを見て調べるのは一つの手だけれども、毎日コンパイルしてあれば全部テストすればわかるわけじゃないですか。あるいは二分探索でもいいけど。これは、みんなちょっと考えれば思いつくんだけど、実際にやるのこれすごい面倒臭いんです。で、まずコンパイルしなきゃいけないわけでしょ。対象にもよりますがそれなりの時間がかかるわけですよ。で、真ん中毎に試すとかいうと、残しとくにはディスクが必要だし、消しちゃうとそこで問題が再現したかどうかおぼえてられないしさ、で二分探索すると、二分探索って、人間にあわないんですよね。まあ、指が 16 本あって 16 進数で世界が動いていたらよかったと思うんですけど、えと、10 を 5 にわけて、5 の次をどうわけるかとか。
![akr13.jpg]({{base}}{{site.baseurl}}/images/0008-Hotlinks-2/akr13.jpg)

__笹田__　うん。

__田中__　なんかうまく分かれないし、それから、二分探索してるとどっちに失敗があったのか、どっちに切れ目があったのか、忘れちゃうことがあったり。可能なことは知ってるんだけど、現実的には面倒臭くてやらないことが多い、というテクニックなんですけども。

でもそんなのは機械的にやればいいわけで、機械的に毎日コンパイルしておいて、で、全部がーっとテストさえ試せば切れ目が一目瞭然、という。で、ここで導入されたんだというと、そこの変化を diff でとれば、これでもうこの中にバグが入ってると。

__笹田__　なるほど。今やってる ruby の [autobuild](http://cvs.m17n.org/cgi-bin/viewcvs/autobuild/?cvsroot=ruby) っていうのはそれの話？

__田中__　autobuild 自身はもっと簡単な話ですね。まあ似てなくもないけど。

__笹田__　じゃあもっとそれをそれももっと難しく、難しいというか密にしようと。

__田中__　そうですね。cron で実行してログを取って。

__笹田__　あれがもっと便利になるという感じ？

__田中__　ちょっと質が違うものになるはずです。

__笹田__　なるほど。

__田中__　autobuild は最新のいくつかしかコンパイルしたのを保存してないけれど、こっちはもっとディスクを使って、たくさん保存してあります。で、Web から (認証付で) テストを登録することができる予定。で、登録したテストは過去にコンパイルされたのに対して実行される。予定ですが。いやまあ、なかなかすすまなくて、しょぼいものしかできてないのが問題なんだけども。

__笹田__　[DamageControl](http://hieraki.lavalamp.ca/) とかともまた違うんですね? あれは commit されたら make だから。

__田中__　あれはそうですね。autobuild に似てますね。あれは画面がかっこいいですね。autobuild と比べるとあっちの方がきれいな気がします。

autobuild は何がいいんですかね。シンプルなところですかね。autobuild の問題は、autobuild は何で始めたんだっけな。

__笹田__　自分がバグを見つけたいからじゃないですかね。

__江渡__　まつもとさんが毎日はテストしないからとかそういう話から……

__田中__　そうかもしれないね。あるいは自分が気付いてても他の人がなんで気付かないんだっていう憤りかな。じゃあメールかけばいいじゃんっていうのはそうなんだけど、メールかくの面倒だし。

__笹田__　(笑)

__田中__　でも問題はさあ、autobuild になってもやっぱり、メールかかないわけですよね。誰がかいてるかというと西山さんがかいてるんだけど (笑)

__笹田__　(笑)

__田中__　いや非常にありがたい話ですが。なかなか難しいところですね。結局ああここで問題が入ったかってわかったらそれで満足してしまう。

__笹田__　やっぱメールだす機能も必要って。

__田中__　うん、そうですね。

__笹田__　いま作ってるやつではそういう機能が入るんですか？

__田中__　あいや、それは違います。入んないと思いますよ。

__笹田__　ま、バグをみつけるってことですか

__田中__　うん。そういやメールを送るのは gcc でやってるって聞いたことがありますね。新部さん[^29]に聞いたんですけども、gcc ではテストを定期的にして、で、それでバグが、というかまあテストが失敗すると、前回から今回のところまでの ChangeLog に入ってるメールアドレスにがーんとメールを送る、というのがあるんだと、言ってました。

__笹田__　へぇ。

__田中__　それはそれでちょっとなにかという気もしますが。

__笹田__　今度はユニットテストでメールアドレスかなにかを書く欄をおいといて、テストが失敗したらがーっとメールを出す。

__田中__　どうなんでしょうね。Ruby ぐらいだと要らないと思うんだけど。ああつまり Ruby ぐらいだとみんな見渡して理解できる。

OS とかだと、OS 全体とかいわれると、全部を一人で把握するのは無理なので。適切なところに送らないといけないと思いますが。Ruby だと規模の問題として別にそこまでの機構はいらないんじゃない、と思います。

__笹田__　なるほどね。

__田中__　そうそう、autobuild は最近は警告の数を数えているんです。正確には「warn」という 4 文字の文字列を数えていて、たまに増えたり減ったりするんですよ。でまあ増えたときはちょっと diff をとって何が原因で増えたのか調べてます。何かの拍子に増えたときに、警告が増えるときにはこれはなんかバグが入ったということを意味しているのではないかということでね。

まあただ、そもそもなんで警告があんなに多いのかという問題はありますけど。

__笹田__　うん。

__田中__　まあ autobuild 自身は -Wall でやってるから警告ですぎなんですけど。それでも例えば unused variable が残ってるんですよね。たくさん。誰も消さないんだけど

__笹田__　うん。

__田中__　消しても文句を言われることは絶対ないと思うんですが。

__笹田__　誰も -Wall やってないからじゃない？

__田中__　-Wall じゃなくても普通にやれば出ます [^30]。

__笹田__　なるほど。

__田中__　-Wall で出てまあ消さなくていいかなと思うのは &amp;&amp; と || を括弧でくくれってやつとかは、まあ問題ないかなと思うんだけど。unused variable は削除するだけだから、消していけない理由はどこにもない、と思うんですが、誰もやらないなあと。まあ、俺もたまにやろうかなと思ったりもするんですが、結局やらないままなんだけど。

__笹田__　ふむ。

__田中__　他にもインストールが失敗するってことがたまにありますね。make install って時間がかかるんで、やらないで commit する人はそれなりにいるんですよ。

あるいはクリーンインストールしないと再現しない問題とか (笑) あるんですよ。まあ checkout してインストール先が空っていうのは私も滅多にやんないんで開発者はみんなそうだと思うんですが。これでトラブるのは、例えばつまりライブラリを減らしたんだけど、なんか require するところが残っていて、でも以前インストールしたものが残ってるから動いちゃうとかいうケースですね。こういうのはクリーンインストールしないとわかんなくて、これは、素早く発見できるようになった気がする。

### おすすめのライブラリ

__笹田__　Ruby のライブラリでなんか宣伝したいものがあれば。

__田中__　宣伝。

__笹田__　HTree と WebApp がぱっと浮かんだんですが

__田中__　まあそれはユーザが外にいるという意味で比較的名が知れている。他にはそういうのあんまりないんじゃないですかね。この前 [ruby-tzfile](http://raa.ruby-lang.org/project/ruby-tzfile) を使っている人がいて、ちょっと驚きましたが。

__笹田__　タイムゾーン？

__田中__　そう、zoneinfo のファイルを直接読んで現在のローカルタイム以外の時間を扱えるっていうライブラリです。

__笹田__　[ruby-cvs](http://raa.ruby-lang.org/project/ruby-cvs) は？

__田中__　あれは、まあ、いいんじゃないですか、いいんじゃないというか、あんまり使ってないんで。

まあでも、宣伝しなくても、自然に入っていくっていうのが理想かな。必要なときにそこにあって自然に使われる。たとえば [open-uri](ruby-man:open-uri.rb) や [pp](ruby-man:pp.rb) って全然宣伝した覚えがない。でも、どっちもすごく使われている。逆に、同様に標準添付なものの中で [tsort](ruby-man:TSort) は、同様に全然宣伝してなくて誰も使っていないわけですが。

__笹田__　(笑) なんで標準添付になったんですか?

__田中__　主張したからです。

__笹田__　へぇ。

__田中__　主張して accept されたから。まあ理由はもちろんあって、あれ、書くのは凄い難しいんですよ。あれが標準にないと、あれが必要になったときに、まずあれを書くところで疲れちゃう、んで、あってもいいんじゃないですかね、といったら通ったので、つけてもらった。

__江渡__　どの状況がそれが必要な状況かってすぐ分かるのかなぁ。

__田中__　どうなんでしょう。Topological sort っていうのはまあたまに使わないでもないですが。

__笹田__　スケジューラを作りたいとか (笑)

__田中__　うーん。どうなんでしょう。まああれは使いやすさの点でもちょっと問題があって。継承しないと使えないんですよね。そういう使いやすさの点でちょっと反省がありまして。まあ改善というかもうちょっと簡単に使えるようにしたいなあとは思ってますけど。

まあそれでも使う人はあんまりいないかもなぁ。

でも、あれが pp や open-uri 以上に使われることはなさそうだよなあ。

#### ドキュメントのあるべき姿とは

__笹田__　まあ今度ライブラリの紹介記事書いてください。

__田中__　記事ねえ。だから宣伝するよりは、必要になったときにそこにあって使われるのが理想なんですが。

__笹田__　pp とか open-uri はいいんだけど。それで。使い方分かるから。

__田中__　それでいいじゃん。

でも open-uri の使い方がわかると、みんな信じてるんですかね。まあ一番簡単な使い方はみんな知ってると思うんですが、いちおうあれだって、背後には隠れてるものがあるわけですよ。あれは実は VFS っぽい仕組みが考慮されているとか、だから HTTP と FTP 以外がなんかできるかもしれないとかあるんですが。

__笹田__　WebApp とかはやっぱぱっと見ねえ。調べないとねえ。HTree とか。

__田中__　まあ両方とも、特に WebApp は頭に書いてありますけど。使い方。

__笹田__　英語でしょ。

__田中__　もちろん英語ですけど。ドキュメントは英語で書くことにしています。日本語では書かない。

__笹田__　それ読めないから。私。

__田中__　じゃあそういう人にはちょっと縁がなかったっていうことで。

__笹田__　(笑)

__江渡__　あれですんなり分かる人はかなり特殊な人だと思いました。

__田中__　どっち？

__江渡__　いや両方とも HTree も WebApp も。

__田中__　そうですか。

__笹田__　やっぱ解説書かなきゃ。

__江渡__　やっぱね、非常に特殊ですよね。特別に使いやすいっていう面もひとつにはあって、HTree とか、HTree(文字列) って書いたりするじゃないですか。

__田中__　そう。

__江渡__　一番使いやすいやつは短くあるべきだっていう理念があるからそうなってるっていうのは分かるんだけど、クラス名は関数名にならないだろうとか。

__田中__　ちょっと意外ではありますね。それは分かってるんですけど。もちろん例は他にもいくつかあるんですよ。Complex とか Rational とか。ないわけではないんだけど Ruby 的にちょっと意外だっていう事は認めます。

__江渡__　そういう操作が可能だっていうことをまず知らなかったから。その場合はなんか例文として書いてあったときでさえアレって思って、これが使い方の説明なのだって言うことを脳が受け付けなかったですね。

__田中__　(笑)

__江渡__　で一旦その理念があるじゃないですか。理念があってああなるほどって理解しちゃうと理解できるんだけど。ようやくそれがサンプル文に見えてくる。

それと同じようなのが他にもありますよね、書き換え可能でないっていうのが、あえて理念としてそうなってるんだってことを飲み込むまでは。

__田中__　それは書いてないもんなあ。

__江渡__　REXML との比較で書いてあったから、それでようやく理解したんだけど。REXML は書き換え可能だけど HTree はそうじゃないと。あえてそうしてるんだっていうことを理解して、そうじゃない使い方をするんだって言うことで、そうか関数型っていう話なのねってようやく理解できて、どんどん書き換えないで新しいの作るっていう方法で使うんだっていうのを、コンセプトが違うんだよって言われない限り絶対理解できない。

__田中__　まあコンセプトの話は、どこに書くかって言うのはちょっと難しいですね。RDoc で書いてるんだけど RDoc って所詮はリファレンスマニュアルなので、コンセプトとかあるいはチュートリアルをどこに書くかは迷いますね。

__江渡__　「ちゅーとりある」っていうファイルに書けばいいんですよ。

__田中__　なるほど。まあそれでも RDoc からリンクはできるか。まあそれがいいかな。

__笹田__　るびま。

__田中__　るびまだと日本語じゃないですか。

__笹田__　とりあえず日本語。

いやもちろん英語があってっていう前提だと思いますけど

__田中__　ドキュメントは英語で書くことにしています。

__笹田__　じゃあるびまで英語で書いてあるチュートリアル全部日本語にしようか。そういうシリーズを。

__江渡__　それやってほしい。むちゃくちゃやってほしい。

__田中__　まあ、WebApp も HTree もあまりドキュメントうまく書けたとは思ってないんだけど、必要なことは書いたつもりです。でもトータルでうまく筋道だって説明できてるかって言うとそこまではうまくいってないですね。ドキュメントそのものはある程度の量は入ってますが。RDoc で。

__笹田__　ドキュメントの拡充は今後に期待ということで。

__田中__　まあでも WebApp も HTree も対抗馬が強いからなかなか。

__笹田__　WebApp の対抗馬って何？

__田中__　たくさんあるんじゃないの。標準添付では CGI かな。

__笹田__　Narf とか？

__田中__　Narf もそうかな、あるいは CGIKit とか Ruby on Rails でもいいんですが。あのへんはもう対抗馬というにはでかすぎて、世界が違いますけど

----
[ [1]({{base}}{% post_url articles/0008/2005-07-19-0008-Hotlinks-1 %}) | 2 | [3]({{base}}{% post_url articles/0008/2005-07-19-0008-Hotlinks-3 %}) ]

[^1]: FM77: 富士通のマシン。
[^2]: shallow binding: 「浅い」束縛。http://c2.com/cgi/wiki?ShallowBinding など参照
[^3]: OS-9: 6809 や、後には 680x0 上で動いた RTOS 。だいたい本文中に語られているような特徴を持っていたらしい
[^4]: マイクロウェア: 現在の RadiSys http://www.radisys.com
[^5]: operator overloading: 演算子の挙動を独自に定義する機能。Ruby で言えば def +(o); end で + が再定義できるから、Ruby にはこの機能がある。
[^6]: NEWS: Sony が当時売っていたエンジニアリングワークステーション
[^7]: 実際には「拡張を容易とするプログラミング言語の研究」
[^8]: 渡部卓雄氏、現東京工業大学
[^9]: PostScript: 考え方としては非常に単純なので、ちょっと勉強すればわりとだれでも書ける。書けたからと言って読めるとは限らないが……
[^10]: 片山紀生氏、現国立情報学研究所
[^11]: 二木厚吉氏 現北陸先端科学技術大学院大学
[^12]: 中島達夫氏 現早稲田大学
[^13]: 篠田陽一氏 現北陸先端科学技術大学院大学
[^14]: 片山卓也氏 現北陸先端科学技術大学院大学
[^15]: 落水浩一郎氏 現北陸先端科学技術大学院大学
[^16]: 役に立つ:ささだの研究成果が外に出て役になっているわけではなさそう……
[^17]: PRO: 情報処理学会のプログラミング研究会。
[^18]: 守岡知彦氏 現京都大学
[^19]: 小林修平氏
[^20]: CHISE: 前回の江渡さんのインタビュー参照
[^21]: 戸村哲氏、現産業技術総合研究所
[^22]: 半田剣一氏、現産業技術総合研究所
[^23]: 新しい漢字コード: JIS X 0213。
[^24]: Gang Of Four, 「デザインパターン」の本の作者四人
[^25]: Shiro Kawai 氏、Gauche scheme interpreter の作者
[^26]: http://www.namikilab.tuat.ac.jp/~sasada/diary/200501.html#cc2-3 [Gauche:Schemeコードのファイナライザ](http://www.shiro.dreamhost.com/scheme/wiliki/wiliki.cgi?Gauche%3aScheme%a5%b3%a1%bc%a5%c9%a4%ce%a5%d5%a5%a1%a5%a4%a5%ca%a5%e9%a5%a4%a5%b6)
[^27]: この話は 0002-RubyCore に載っていた気が
[^28]: ささだ注:変な論文は書いてないつもりではありますが
[^29]: 新部裕氏 現産業技術総合研究所
[^30]: unused variables: これは勘違いで、出ない
